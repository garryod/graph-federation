apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: graph-stable
  namespace: {{ .Release.Namespace }}
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  project: {{ default .Release.Namespace .Values.project }}
  source:
    repoURL: {{ .Values.source.repoURL }}
    targetRevision: {{ .Values.source.targetRevision }}
    path: {{ .Values.source.graph.path }}
    helm:
      valuesObject:
        router:
          configuration:
            telemetry:
              exporters:
                metrics:
                  common:
                    resource:
                      "service.name": "router-stable"
                  otlp:
                    enabled: true
                    endpoint: 'graph-monitoring-opentelemetry-collector:4317'
                    protocol: grpc
                tracing:
                  common:
                    resource:
                      "service.name": "router-stable"
                  otlp:
                    enabled: true
                    endpoint: 'graph-monitoring-opentelemetry-collector:4317'
                    protocol: grpc
                  propagation:
                    trace_context: true
  destination:
    name: {{ .Values.destination.name }}
    server: {{ .Values.destination.server }}
    namespace: {{ default .Release.Namespace .Values.destination.namespace }}
